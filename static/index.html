<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nasiko Agent // Multi-Theme</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=JetBrains+Mono:wght@400;700&family=Share+Tech+Mono&family=VT323&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- BASE VARIABLES (Default: Aurora) --- */
        :root {
            --bg-main: #020617;
            --panel-bg: rgba(15, 23, 42, 0.7);
            --panel-border: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
            --text-muted: #cbd5e1;
            --accent: #c084fc;
            --accent-glow: rgba(192, 132, 252, 0.5);
            
            /* Fonts */
            --font-ui: 'Space Grotesk', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
            
            /* Shapes */
            --radius-panel: 24px;
            --radius-btn: 22px;
        }

        /* --- THEME OVERRIDES --- */
        body.theme-cyberpunk {
            --bg-main: #050505;
            --panel-bg: rgba(0, 10, 10, 0.9);
            --panel-border: #00f3ff;
            --text-main: #00f3ff;
            --text-muted: rgba(0, 243, 255, 0.6);
            --accent: #ff00ff;
            --accent-glow: rgba(255, 0, 255, 0.5);
            --font-ui: 'Share Tech Mono', monospace;
            --font-code: 'VT323', monospace;
            --radius-panel: 0px;
            --radius-btn: 0px;
        }

        body.theme-saas {
            --bg-main: #0f172a;
            --panel-bg: #1e293b;
            --panel-border: #334155;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --accent: #6366f1;
            --accent-glow: rgba(99, 102, 241, 0.4);
            --font-ui: 'Outfit', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
            --radius-panel: 12px;
            --radius-btn: 8px;
        }

        /* --- GLOBAL RESET --- */
        * { box-sizing: border-box; outline: none; transition: background 0.3s, color 0.3s, border-color 0.3s; }
        
        body {
            margin: 0;
            background-color: var(--bg-main);
            color: var(--text-main);
            font-family: var(--font-ui);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* --- BACKGROUNDS --- */
        .bg-aurora .orb {
            position: absolute; border-radius: 50%; filter: blur(80px); z-index: -1; opacity: 0.5;
            animation: float 10s infinite alternate ease-in-out;
        }
        .orb-1 { width: 400px; height: 400px; background: #9333ea; top: -50px; left: -100px; }
        .orb-2 { width: 500px; height: 500px; background: #2563eb; bottom: -100px; right: -100px; animation-delay: -2s; }
        
        body.theme-cyberpunk {
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
        }
        
        body.theme-saas {
            background-image: 
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(168, 85, 247, 0.15) 0px, transparent 50%);
        }

        @keyframes float { 0% { transform: translate(0, 0); } 100% { transform: translate(30px, 50px); } }

        /* --- LAYOUT --- */
        header {
            padding: 1.5rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            border-bottom: 1px solid transparent;
        }

        body.theme-cyberpunk header { border-bottom-color: var(--text-main); box-shadow: 0 0 15px var(--text-main); background: #000; }
        body.theme-saas header { border-bottom-color: var(--panel-border); background: rgba(15,23,42,0.8); backdrop-filter: blur(10px); }

        .logo { font-size: 1.5rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        
        .theme-switch {
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 20px;
            padding: 4px;
            display: flex;
            gap: 4px;
        }
        
        .theme-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            padding: 6px 12px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 0.8rem;
            font-family: var(--font-ui);
        }
        
        .theme-btn.active { background: var(--accent); color: white; font-weight: bold; }
        body.theme-cyberpunk .theme-btn.active { background: var(--text-main); color: #000; border-radius: 0; }
        body.theme-saas .theme-btn { border-radius: 6px; }

        main {
            flex: 1;
            display: flex;
            gap: 2rem;
            padding: 1rem 3rem 3rem 3rem;
            height: calc(100vh - 80px);
        }

        /* --- PANELS --- */
        .panel {
            flex: 1;
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: var(--radius-panel);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }
        
        body.theme-cyberpunk .panel { box-shadow: 0 0 10px rgba(0, 243, 255, 0.2); }
        body.theme-saas .panel { box-shadow: 0 20px 40px -10px rgba(0,0,0,0.5); }

        .panel-header {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--panel-border);
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
        }

        .dots { display: none; gap: 6px; margin-right: 10px; }
        body.theme-saas .dots { display: flex; }
        .dot { width: 10px; height: 10px; border-radius: 50%; }
        .red { background: #ef4444; } .yellow { background: #eab308; } .green { background: #22c55e; }

        .editor {
            flex: 1; width: 100%; height: 100%;
            background: transparent; border: none;
            color: var(--text-main);
            padding: 20px;
            font-family: var(--font-code);
            font-size: 15px; line-height: 1.6;
            resize: none;
            transition: all 0.2s;
        }
        .editor::placeholder { color: var(--text-muted); opacity: 0.5; }

        /* --- DRAG & DROP STYLES --- */
        .editor.drag-over {
            background: rgba(255, 255, 255, 0.05);
            box-shadow: inset 0 0 20px var(--accent-glow);
            border: 2px dashed var(--accent);
        }

        /* --- STYLE SELECTOR --- */
        .style-select {
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--panel-border);
            color: var(--text-muted);
            padding: 4px 8px;
            border-radius: 6px;
            font-family: var(--font-ui);
            font-size: 0.8rem;
            outline: none;
            margin-left: auto;
            margin-right: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .style-select:hover {
            border-color: var(--accent);
            color: var(--text-main);
        }
        .style-select option {
            background: #0f172a;
            color: white;
        }
        body.theme-cyberpunk .style-select { border-color: var(--text-muted); border-radius: 0; }
        body.theme-saas .style-select { background: white; color: #1e293b; border-color: #cbd5e1; }
        body.theme-saas .style-select option { background: white; color: #1e293b; }


        /* --- HEALTH BADGE --- */
        .health-badge {
            display: none;
            align-items: center;
            gap: 10px;
            padding: 4px 12px;
            border-radius: 20px;
            font-family: var(--font-code);
            font-size: 0.85rem;
            border: 1px solid transparent;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        .rank-circle {
            width: 24px; height: 24px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold;
            color: #000;
        }

        .health-A { background: rgba(34, 197, 94, 0.2); border-color: #22c55e; color: #22c55e; }
        .health-A .rank-circle { background: #22c55e; }

        .health-B { background: rgba(234, 179, 8, 0.2); border-color: #eab308; color: #eab308; }
        .health-B .rank-circle { background: #eab308; }

        .health-C { background: rgba(249, 115, 22, 0.2); border-color: #f97316; color: #f97316; }
        .health-C .rank-circle { background: #f97316; }

        .health-F { background: rgba(239, 68, 68, 0.2); border-color: #ef4444; color: #ef4444; }
        .health-F .rank-circle { background: #ef4444; color: white;}

        body.theme-cyberpunk .health-badge {
            border-radius: 0;
            background: black;
            box-shadow: 2px 2px 0px currentColor;
        }
        body.theme-cyberpunk .rank-circle { border-radius: 0; }

        /* --- ACTIONS --- */
        .actions { display: flex; flex-direction: column; justify-content: center; gap: 15px; }

        .action-btn {
            width: 64px; height: 64px;
            border-radius: var(--radius-btn);
            border: none;
            background: var(--accent);
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 0 20px var(--accent-glow);
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.2s;
        }
        .action-btn:hover { transform: scale(1.1); }
        .action-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        body.theme-cyberpunk .action-btn {
            background: transparent; border: 1px solid var(--accent); color: var(--accent);
            box-shadow: 0 0 10px var(--accent);
        }
        body.theme-cyberpunk .action-btn:hover {
            background: var(--accent); color: #000; box-shadow: 0 0 30px var(--accent);
        }

        .icon-btn { background: transparent; border: none; color: var(--text-muted); cursor: pointer; padding: 5px; font-size: 1rem; }
        .icon-btn:hover { color: var(--text-main); }
        
        .spinner {
            width: 24px; height: 24px; border: 3px solid rgba(255,255,255,0.3);
            border-top-color: #fff; border-radius: 50%;
            animation: spin 1s linear infinite; display: none;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 900px) {
            main { flex-direction: column; padding: 1rem; height: auto; }
            .panel { min-height: 400px; }
            .actions { flex-direction: row; margin: 10px 0; }
            body { overflow-y: auto; }
        }
    </style>
</head>
<body class="theme-aurora bg-aurora">

    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>

    <header>
        <div class="logo">
            <span id="logo-icon">‚ú®</span> Nasiko Agent
        </div>
        
        <div class="theme-switch">
            <button class="theme-btn active" onclick="setTheme('aurora')">Aurora</button>
            <button class="theme-btn" onclick="setTheme('cyberpunk')">Cyber</button>
            <button class="theme-btn" onclick="setTheme('saas')">SaaS</button>
        </div>
    </header>

    <main>
        <div class="panel">
            <div class="panel-header">
                <div style="display:flex; align-items:center;">
                    <div class="dots"><div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div></div>
                    <span>Input Source</span>
                </div>

                <select id="docStyle" class="style-select">
                    <option value="Google">Google Style</option>
                    <option value="NumPy">NumPy Style</option>
                    <option value="Sphinx/reStructuredText">Sphinx / RST</option>
                    <option value="Epytext">Epytext</option>
                </select>

                <button class="icon-btn" onclick="document.getElementById('fileInput').click()" title="Upload File">üìÇ</button>
                <input type="file" id="fileInput" style="display: none;" accept=".py,.txt">

                <button class="icon-btn" onclick="document.getElementById('codeInput').value=''" title="Clear Code">üóëÔ∏è</button>
            </div>
            
            <textarea id="codeInput" class="editor" spellcheck="false" placeholder="# Paste Python code here...&#10;# OR Drag & Drop a .py file"></textarea>
        </div>

        <div class="actions">
            <button id="generateBtn" class="action-btn" onclick="generateDocs()">
                <span id="btnIcon">‚ö°</span>
                <div id="spinner" class="spinner"></div>
            </button>
        </div>

        <div class="panel">
            <div class="panel-header">
                <div style="display:flex; align-items:center; gap: 15px;">
                    <div class="dots"><div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div></div>
                    <span>Result</span>
                    
                    <div id="healthBadge" class="health-badge">
                        <div class="rank-circle" id="badgeRank">A</div>
                        <span id="badgeLabel">Clean Code</span>
                    </div>

                </div>
                <div style="display:flex; gap: 5px;">
                    <button class="icon-btn" onclick="downloadCode()" title="Download File">‚¨áÔ∏è</button>
                    <button class="icon-btn" onclick="copyToClipboard()" title="Copy to Clipboard">üìã</button>
                </div>
            </div>
            <textarea id="outputCode" class="editor" readonly placeholder="// Output awaits..."></textarea>
        </div>
    </main>

    <script>
        // --- DRAG AND DROP LOGIC ---
        const dropZone = document.getElementById('codeInput');

        dropZone.addEventListener('dragover', (e) => {
            e.stopPropagation(); e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';
            dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.stopPropagation(); e.preventDefault();
            dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
            e.stopPropagation(); e.preventDefault();
            dropZone.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) readFile(files[0]);
        });

        // --- MANUAL UPLOAD LOGIC ---
        const fileInput = document.getElementById('fileInput');
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) readFile(file);
        });

        // --- SHARED FILE READING FUNCTION ---
        function readFile(file) {
            const reader = new FileReader();
            reader.onload = (event) => {
                document.getElementById('codeInput').value = event.target.result;
            };
            reader.readAsText(file);
        }

        function setTheme(themeName) {
            const body = document.body;
            body.className = '';
            body.classList.add('theme-' + themeName);
            
            if(themeName === 'aurora') {
                body.classList.add('bg-aurora');
                document.querySelector('.orb-1').style.display = 'block';
                document.querySelector('.orb-2').style.display = 'block';
                document.getElementById('logo-icon').innerText = '‚ú®';
            } else {
                document.querySelector('.orb-1').style.display = 'none';
                document.querySelector('.orb-2').style.display = 'none';
                if(themeName === 'cyberpunk') document.getElementById('logo-icon').innerText = 'üíÄ';
                if(themeName === 'saas') document.getElementById('logo-icon').innerText = '‚ö°';
            }

            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.innerText.toLowerCase().includes(themeName.substring(0,4))) {
                    btn.classList.add('active');
                }
            });
        }

        async function generateDocs() {
            const inputCode = document.getElementById("codeInput").value;
            const styleInput = document.getElementById("docStyle").value;
            const outputArea = document.getElementById("outputCode");
            const btn = document.getElementById("generateBtn");
            const icon = document.getElementById("btnIcon");
            const spinner = document.getElementById("spinner");
            const badge = document.getElementById("healthBadge");

            if (!inputCode.trim()) {
                outputArea.value = "‚ö†Ô∏è Error: No code detected.";
                return;
            }

            badge.style.display = 'none';
            btn.disabled = true;
            icon.style.display = "none";
            spinner.style.display = "block";
            outputArea.style.opacity = "0.5";
            outputArea.value = "// Processing...";

            try {
                const response = await fetch('/generate-docs/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        code: inputCode,
                        style: styleInput
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    outputArea.style.opacity = "1";
                    typeWriter(data.documented_code, outputArea);
                    if (data.health) {
                        updateBadge(data.health);
                    }
                } else {
                    outputArea.value = "Error: " + (data.detail || "Server error.");
                }
            } catch (error) {
                console.error(error);
                outputArea.value = "Connection Error: Is the server running?";
            } finally {
                btn.disabled = false;
                spinner.style.display = "none";
                icon.style.display = "block";
            }
        }

        function updateBadge(health) {
            const badge = document.getElementById("healthBadge");
            const rankEl = document.getElementById("badgeRank");
            const labelEl = document.getElementById("badgeLabel");

            badge.className = "health-badge";
            badge.classList.add("health-" + health.rank);
            rankEl.innerText = health.rank;
            labelEl.innerText = health.label + " (Score: " + health.score + ")";
            badge.style.display = "flex";
        }

        function typeWriter(text, element) {
            element.value = "";
            let i = 0;
            const speed = text.length > 500 ? 0 : 5;
            function type() {
                if (i < text.length) {
                    element.value += text.charAt(i);
                    i++;
                    element.scrollTop = element.scrollHeight;
                    setTimeout(type, speed);
                }
            }
            type();
        }

        function copyToClipboard() {
            const text = document.getElementById("outputCode").value;
            if(!text) return;
            navigator.clipboard.writeText(text).then(() => {
                alert("Copied to clipboard!");
            });
        }

        // --- NEW DOWNLOAD FUNCTION ---
        function downloadCode() {
            const text = document.getElementById("outputCode").value;
            if(!text) return;

            const blob = new Blob([text], { type: "text/x-python" });
            const link = document.createElement("a");
            
            link.href = URL.createObjectURL(blob);
            link.download = "documented_code.py";
            
            document.body.appendChild(link);
            link.click();
            
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }
    </script>
</body>
</html>